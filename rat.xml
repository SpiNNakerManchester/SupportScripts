<?xml version="1.0" encoding="UTF-8"?>
<project name="rat"
		xmlns:rat="antlib:org.apache.rat.anttasks"
		xmlns:if="ant:if" xmlns="antlib:org.apache.tools.ant">
    <target name="rat">
    	<rat:report reportFile="${user.dir}/RAT_report.txt">
    		<fileset dir="${user.dir}" defaultexcludes="yes"
    			excludesfile="${user.dir}/.ratexcludes"
    			excludes="RAT_report.txt" />
    	</rat:report>
    	<fail message="RAT_report.txt not generated">
    		<condition>
    			<not>
	    			<resourcecount count="1">
	    				<fileset dir="${user.dir}" includes="RAT_report.txt" />
	    			</resourcecount>
    			</not>
    		</condition>
    	</fail>
    	<loadfile property="report" srcfile="${user.dir}/RAT_report.txt">
    		<filterchain>
    			<tokenfilter>
    				<filetokenizer />
	    			<replaceregex
	    				pattern="\s*Printing headers for text files without a valid license header.*"
	    				replace="" flags="s" />
    			</tokenfilter>
    		</filterchain>
    	</loadfile>
		<condition property="problems">
			<not>
    			<contains string="${report}"
    				substring="&#10;0 Unknown Licenses" />
			</not>
		</condition>
    	<echo if:set="problems" message="${report}" />
    	<fail message="Unknown Licenses found">
    		<condition>
    			<not>
        			<contains string="${report}"
        				substring="&#10;0 Unknown Licenses" />
    			</not>
    		</condition>
    	</fail>
    </target>
</project>
